!function(){const t=!1,e=new Set,n=JSON.parse;async function r(e,n=0){let o=0;for(let i in e)if(0!=o&&(n=0),o++,"object"!=typeof e[i]){if("string"==typeof e[i]){if(a(e[i])){let t=h(e[i]);t&&g({action:"ccScriptMsgAddMedia",url:e[i],href:location.href,ext:t});continue}if("#EXTM3U"==e[i].substring(0,7).toUpperCase()){u(e[i])&&d(e[i]);continue}if("data:application/"==e[i].substring(0,17).toLowerCase()){const t=l(e[i].substring(17));t&&d(t);continue}if(e[i].toLowerCase().includes("urn:mpeg:dash:schema:mpd")){d(e[i],"mpd");continue}t}}else{if(e[i]instanceof Array&&16==e[i].length){let t=!0;for(let n of e[i])if("number"!=typeof n||n>255){t=!1;break}if(t){g({action:"ccScriptMsgAddKey",key:e[i],href:location.href,ext:"key"});continue}continue}if(n>10)continue;r(e[i],++n)}}JSON.parse=function(){let t=n.apply(this,arguments);return r(t),t},JSON.parse.toString=function(){return n.toString()};const o=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(t){t=t.toUpperCase(),this.addEventListener("readystatechange",(function(e){if(200!=this.status)return;if("arraybuffer"==this.responseType&&this.response?.byteLength&&16==this.response.byteLength&&g({action:"ccScriptMsgAddKey",key:this.response,href:location.href,ext:"key"}),""==this.response||"string"!=typeof this.response)return;if("data:application/"==this.response.substring(0,17).toLowerCase()){return void d(l(this.response.substring(17)))}if("data:application/"==this.responseURL.substring(0,17).toLowerCase()){const t=l(this.responseURL.substring(17));return void(t&&d(t))}if(a(this.response)){const t=h(this.response);return void(t&&g({action:"ccScriptMsgAddMedia",url:this.response,href:location.href,ext:t}))}if(this.response.toUpperCase().includes("#EXTM3U")){if("#EXTM3U"==this.response.substring(0,7))return"GET"==t?void g({action:"ccScriptMsgAddMedia",url:this.responseURL,href:location.href,ext:"m3u8"}):void(u(this.response)&&d(this.response));if(f(this.response))return"GET"==t?void g({action:"ccScriptMsgAddMedia",url:this.responseURL,href:location.href,ext:"json"}):void d(this.response,"json")}const n=f(this.response);n&&r(n)})),o.apply(this,arguments)},XMLHttpRequest.prototype.open.toString=function(){return o.toString()};const i=window.fetch;window.fetch=async function(t,e){const n=await i.apply(this,arguments),o=n.clone();return n.arrayBuffer().then((n=>{if(16==n.byteLength)return void g({action:"ccScriptMsgAddKey",key:n,href:location.href,ext:"key"});let o=(new TextDecoder).decode(n);if(""==o)return;"object"==typeof t&&(t=t.url);let i=f(o);if(i)r(i);else{if("#EXTM3U"==o.substring(0,7).toUpperCase())return null==e?.method||e.method&&"GET"==e.method.toUpperCase()?void g({action:"ccScriptMsgAddMedia",url:t,href:location.href,ext:"m3u8"}):void(u(o)&&d(o));if("data:application/"!=o.substring(0,17).toLowerCase());else{const t=l(t.substring(0,17));t&&d(t)}}})),o},window.fetch.toString=function(){return i.toString()};const s=Array.prototype.slice;Array.prototype.slice=function(t,e){let n=s.apply(this,arguments);if(16==e&&32==this.length){for(let t of n)if("number"!=typeof t||t>255)return n;g({action:"ccScriptMsgAddKey",key:n,href:location.href,ext:"key"})}return n},Array.prototype.slice.toString=function(){return s.toString()};const c=window.btoa;window.btoa=function(t){const e=c.apply(this,arguments);return 24==e.length&&"=="==e.substring(22,24)&&g({action:"ccScriptMsgAddKey",key:e,href:location.href,ext:"base64Key"}),"#EXTM3U"==t.toUpperCase().substring(0,7)&&u(t)&&d(t),e},window.btoa.toString=function(){return c.toString()};const p=window.atob;function a(t){return/^http[s]*:\/\/.+/i.test(t)}function u(t){let e=t.split("\n");for(let t of e)if("#"!=t[0])return!!a(t);return!1}function f(t){if("object"==typeof t)return t;if("string"==typeof t)try{return n(t)}catch(t){return!1}return!1}function h(t){let e;try{e=new URL(t)}catch(t){return}if(e=e.pathname.split("."),1!=e.length)return e=e[e.length-1].toLowerCase(),("m3u8"==e||"m3u"==e||"mpd"==e||"mp4"==e||"mp3"==e||"key"==e)&&e}function d(t,e="m3u8"){g({action:"ccScriptMsgAddMedia",url:URL.createObjectURL(new Blob([new TextEncoder("utf-8").encode(t)])),href:location.href,ext:e})}function l(t){const e=["vnd.apple.mpegurl","x-mpegurl","mpegurl"];let n=!1;for(let r of e)if(t.substring(0,r.length).toLowerCase()==r){t=t.substring(r.length+1),n=!0;break}return!!n&&("base64,"==t.substring(0,7).toLowerCase()?window.atob(t.substring(7)):t)}function g(t){const n=t.url?t.url:t.key;if(e.has(n))return!1;e.add(n),t.requestId=Date.now().toString()+e.size,window.postMessage(t)}window.atob=function(t){const e=p.apply(this,arguments);return 24==t.length&&"=="==t.substring(22,24)&&g({action:"ccScriptMsgAddKey",key:t,href:location.href,ext:"base64Key"}),"#EXTM3U"==e.toUpperCase().substring(0,7)&&u(e)&&d(e),e},window.atob.toString=function(){return p.toString()}}();